<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="qlDonhangnhap.css">
    <title>Đơn hàng nhập</title>
    
</head>
<body onload="renderListHDN()">
    <div class="grid">
        <div class="column2">
            <h3 style="padding-left: 25px;">Menu</h3>
            <a href="admin.html">Danh mục</a>
            <a href="QLLSP.html">Quản lý loại sản phẩm</a>
            <a href="quanlysanpham.html">Quản lý sản phẩm</a>
            <a href="quanlynhanvien.html">Quản lý nhân viên</a>
            <a href="quanlykhachhang.html">Quản lý khách hàng</a>
            <a href="quanlydonhangnhban.html">Quản lý đơn hàng bán</a>
            <a href="quanlydonhangnhap.html">Quản lý đơn hàng nhập</a>
            <a href="quanlynhacungcap.html">Quản lý nhà cung cấp</a>
            <a href="/login/login.html">Đăng xuất</a>
        </div>
        <div class="form-DHN">
            <h3>Thông tin đơn hàng nhập</h3>
            <label>Mã đơn hàng nhập</label>
            <input type="text" id="madhn"> <br>
            <span id="madhn-error" class="error"></span>
            <br>
            <label>Mã nhân viên</label>
            <input type="text" id="manv"> <br>
            <span id="manv-error" class="error"></span>
            <br>
            <label>Mã nhà cung cấp</label>
            <input type="text" id="mancc"> <br>
            <span id="mancc-error" class="error"></span>
            <br>
            <label>Địa chỉ</label>
            <input type="text" id="address"> <br>
            <span id="address-error" class="error"></span>
            <br>
            <label>Ngày nhập</label>
            <input type="datetime-local" id="ngaynhap"> <br>
            <span id="ngaynhap-error" class="error"></span>
            <br>
            <label>Thành tiền</label>
            <input type="text" id="thanhtien"> <br>
            <span id="thanhtien-error" class="error"></span>
            <br>
            <label>&nbsp;</label>
            <button onclick="save()">Lưu lại</button>
            <button onclick="clearInputFields()">Xóa trường</button>
        </div>
        
    </div>
    <div class="list-DHN" id="list-DHN">
        <h3>Danh sách đơn hàng nhập</h3>
        <table id="grid-DHN" width="650px" cellpadding="0" cellspacing="0">
        
        </table>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
    <script>
        function save() {
            let madhn = document.getElementById('madhn').value;
            let manv = document.getElementById('manv').value;
            let mancc = document.getElementById('mancc').value;
            let address = document.getElementById('address').value;
            let ngaynhap = document.getElementById('ngaynhap').value;
            let thanhtien = document.getElementById('thanhtien').value;

            // Kiểm tra và xử lý lỗi
            let isValid = true;

            if (_.isEmpty(madhn)) {
                document.getElementById('madhn-error').innerHTML = 'Vui lòng nhập mã đơn hàng nhập!';
                isValid = false;
            } else if (madhn.trim().length > 10) {
                document.getElementById('madhn-error').innerHTML = 'Mã đơn hàng nhập không được lớn hơn 10 ký tự!';
                isValid = false;
            } else {
                document.getElementById('madhn-error').innerHTML = '';
            }

            if (_.isEmpty(manv)) {
                document.getElementById('manv-error').innerHTML = 'Vui lòng nhập mã nhân viên!';
                isValid = false;
            } else if (manv.trim().length > 10) {
                document.getElementById('manv-error').innerHTML = 'Mã nhân viên không được lớn hơn 10 ký tự!';
                isValid = false;
            } else {
                document.getElementById('manv-error').innerHTML = '';
            }

            if (_.isEmpty(mancc)) {
                document.getElementById('mancc-error').innerHTML = 'Vui lòng nhập mã nhà cung cấp!';
                isValid = false;
            } else if (mancc.trim().length > 10) {
                document.getElementById('mancc-error').innerHTML = 'Mã nhà cung cấp không được lớn hơn 10 ký tự!';
                isValid = false;
            } else {
                document.getElementById('mancc-error').innerHTML = '';
            }

            if (_.isEmpty(address)) {
                document.getElementById('address-error').innerHTML = 'Vui lòng nhập địa chỉ!';
                isValid = false;
            } else if (address.trim().length <= 2) {
                document.getElementById('address-error').innerHTML = 'Địa chỉ không được nhỏ hơn 2 ký tự!';
                isValid = false;
            } else if (address.trim().length > 50) {
                document.getElementById('address-error').innerHTML = 'Địa chỉ không được lớn hơn 50 ký tự!';
                isValid = false;
            } else {
                document.getElementById('address-error').innerHTML = '';
            }

            if (_.isEmpty(ngaynhap)) {
                document.getElementById('ngaynhap-error').innerHTML = 'Vui lòng chọn ngày nhập!';
                isValid = false;
            } else {
                document.getElementById('ngaynhap-error').innerHTML = '';
            }

            if (_.isEmpty(thanhtien)) {
                document.getElementById('thanhtien-error').innerHTML = 'Vui lòng nhập thành tiền!';
                isValid = false;
            } else {
                document.getElementById('thanhtien-error').innerHTML = '';
            }

            // Lưu vào danh sách đơn hàng nhập
            if (isValid) {
                console.log("Saving data...");
                let HDNs = localStorage.getItem('HDNs') ? JSON.parse(localStorage.getItem('HDNs')) : [];
                HDNs.push({
                    madhn: madhn,
                    manv: manv,
                    mancc: mancc,
                    address: address,
                    ngaynhap: ngaynhap,
                    thanhtien: thanhtien,
                });
                localStorage.setItem('HDNs', JSON.stringify(HDNs));
                renderListHDN();
                clearInputFields(); // Xóa trường nhập liệu sau khi lưu
            }
        }

        function renderListHDN() {
            let HDNs = localStorage.getItem('HDNs') ? JSON.parse(localStorage.getItem('HDNs')) : [];
            console.log("Rendering list...", HDNs);
            if (HDNs.length === 0) {
                document.getElementById('list-DHN').style.display = 'none';
                return false;
            }

            document.getElementById('list-DHN').style.display = 'block';
            let tableContent = `<tr>
                <td>STT</td>
                <td width='50'>Mã hóa đơn nhập</td>
                <td>Mã nhân viên</td>
                <td>Mã nhà cung cấp</td>
                <td>Địa chỉ</td>
                <td>Ngày nhập</td>
                <td>Thành tiền</td>
                <td>Hành động</td>
                </tr>`;

            HDNs.forEach((HDN, index) => {
                let HDNId = index;
                index++;
                tableContent += `<tr>
                    <td>${index}</td>
                    <td>${HDN.madhn}</td>
                    <td>${HDN.manv}</td>
                    <td>${HDN.mancc}</td>
                    <td>${HDN.address}</td>
                    <td>${HDN.ngaynhap}</td>
                    <td>${HDN.thanhtien}</td>
                    <td>
                        <button class='edit-button' onclick='editHDN(${HDNId})'>Edit</button>
                        <button class='delete-button' onclick='deleteHDN(${HDNId})'>Delete</button>
                    </td>
                </tr>`;
            });

            document.getElementById('grid-DHN').innerHTML = tableContent;
        }

        function clearInputFields() {
            document.getElementById('madhn').value = '';
            document.getElementById('manv').value = '';
            document.getElementById('mancc').value = '';
            document.getElementById('address').value = '';
            document.getElementById('ngaynhap').value = '';
            document.getElementById('thanhtien').value = '';

            document.getElementById('madhn-error').innerHTML = '';
            document.getElementById('manv-error').innerHTML = '';
            document.getElementById('mancc-error').innerHTML = '';
            document.getElementById('address-error').innerHTML = '';
            document.getElementById('ngaynhap-error').innerHTML = '';
            document.getElementById('thanhtien-error').innerHTML = '';
        }

        function deleteHDN(index) {
            let HDNs = localStorage.getItem('HDNs') ? JSON.parse(localStorage.getItem('HDNs')) : [];
            HDNs.splice(index, 1);
            localStorage.setItem('HDNs', JSON.stringify(HDNs));
            renderListHDN();
        }

        function editHDN(index) {
            let HDNs = localStorage.getItem('HDNs') ? JSON.parse(localStorage.getItem('HDNs')) : [];
            let HDN = HDNs[index];

            document.getElementById('madhn').value = HDN.madhn;
            document.getElementById('manv').value = HDN.manv;
            document.getElementById('mancc').value = HDN.mancc;
            document.getElementById('address').value = HDN.address;
            document.getElementById('ngaynhap').value = HDN.ngaynhap;
            document.getElementById('thanhtien').value = HDN.thanhtien;

            deleteHDN(index);
        }
    </script>
</body>
</html>
