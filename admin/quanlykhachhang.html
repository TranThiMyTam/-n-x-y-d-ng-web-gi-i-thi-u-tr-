<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="QLKH.css">
    <title>QLKH</title>
</head>
<body onload="renderListClient()">
    <div class="grid">
        <div class="colum2">
            <h3 style="padding-left: 25px;">Menu</h3>
            <a href="admin.html">Danh mục</a>
            <a href="QLLSP.html">Quản lý loại sản phẩm</a>
            <a href="quanlysanpham.html">Quản lý sản phẩm</a>
            <a href="quanlynhanvien.html">Quản lý nhân viên</a>
            <a href="quanlykhachhang.html">Quản lý khách hàng</a>
            <a href="quanlydonhangnhban.html">Quản lý đơn hàng bán</a>
            <a href="quanlydonhangnhap.html">Quản lý đơn hàng nhập</a>
            <a href="quanlynhacungcap.html">Quản lý nhà cung cấp</a>
            <a href="/login/login.html"> Đăng xuất</a>
        </div>
        <div class="form-khachhang">
            <h3>Thông tin khách hàng</h3>
            <label>Mã khách hàng</label>
            <input type="text" id="makh"> <br>
            <span id="makh-error" class="error"></span>
            <br>
            <label>Họ và tên</label>
            <input type="text" id="fullname"><br>
            <span id="fullname-error" class="error"></span>
            <br>
            <label>Quê quán</label>
            <input type="text" id="address"><br>
            <span id="address-error" class="error"></span>
            <br>
            <label>Số điện thoại</label>
            <input type="text" id="phone"> <br>
            <span id="phone-error" class="error"></span>
            <br>
            <label>&nbsp;</label>
            <button onclick="save()">Lưu lại</button>
        </div>
       
    </div>
    <div class="list-khachhang" id="list-khachhang">
        <h3>Danh sách khách hàng </h3>
        <table id="grid-clients" width="650px" border="1" cellpadding="0" cellspacing="0">
            
        </table>
    </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
<script>
    console.log(localStorage.getItem('clients'));

    let editIndex = -1; // Biến để lưu trữ vị trí khách hàng đang được chỉnh sửa

    function save() {
        let makh = document.getElementById('makh').value;
        let fullname = document.getElementById('fullname').value;
        let address = document.getElementById('address').value;
        let phone = document.getElementById('phone').value;

        // Kiểm tra và xử lý lỗi
        let isValid = true;
        if (_.isEmpty(makh)) {
            document.getElementById('makh-error').innerHTML = 'Vui lòng nhập mã khách hàng!';
            isValid = false;
        } else if (makh.trim().length > 10) {
            document.getElementById('makh-error').innerHTML = 'Mã khách hàng không được lớn hơn 10 ký tự!';
            isValid = false;
        } else {
            document.getElementById('makh-error').innerHTML = '';
        }

        if (_.isEmpty(fullname)) {
            document.getElementById('fullname-error').innerHTML = 'Vui lòng nhập họ và tên!';
            isValid = false;
        } else if (fullname.trim().length <= 2) {
            document.getElementById('fullname-error').innerHTML = 'Họ và tên không được nhỏ hơn 2 ký tự!';
            isValid = false;
        } else if (fullname.trim().length > 50) {
            document.getElementById('fullname-error').innerHTML = 'Họ và tên không được lớn hơn 50 ký tự!';
            isValid = false;
        } else {
            document.getElementById('fullname-error').innerHTML = '';
        }

        if (_.isEmpty(address)) {
            document.getElementById('address-error').innerHTML = 'Vui lòng nhập quê quán!';
            isValid = false;
        } else if (address.trim().length <= 2) {
            document.getElementById('address-error').innerHTML = 'Quê quán không được nhỏ hơn 2 ký tự!';
            isValid = false;
        } else if (address.trim().length > 50) {
            document.getElementById('address-error').innerHTML = 'Quê quán không được lớn hơn 50 ký tự!';
            isValid = false;
        } else {
            document.getElementById('address-error').innerHTML = '';
        }

        if (_.isEmpty(phone)) {
            document.getElementById('phone-error').innerHTML = 'Vui lòng nhập số điện thoại!';
            isValid = false;
        } else if (phone.trim().length > 10) {
            document.getElementById('phone-error').innerHTML = 'Số điện thoại không đúng!';
            isValid = false;
        } else {
            document.getElementById('phone-error').innerHTML = '';
        }

        // Lưu vào danh sách khách hàng
        if (isValid) {
            let clients = localStorage.getItem('clients') ? JSON.parse(localStorage.getItem('clients')) : [];
            if (editIndex === -1) {
                // Thêm mới khách hàng
                clients.push({
                    makh: makh,
                    fullname: fullname,
                    address: address,
                    phone: phone,
                });
            } else {
                // Chỉnh sửa khách hàng
                clients[editIndex] = {
                    makh: makh,
                    fullname: fullname,
                    address: address,
                    phone: phone,
                };
                editIndex = -1; // Reset editIndex sau khi lưu
            }
            localStorage.setItem('clients', JSON.stringify(clients));
            renderListClient();

            // Clear các ô nhập liệu sau khi lưu thành công
            document.getElementById('makh').value = '';
            document.getElementById('fullname').value = '';
            document.getElementById('address').value = '';
            document.getElementById('phone').value = '';
        }
    }

    function renderListClient() {
        let clients = localStorage.getItem('clients') ? JSON.parse(localStorage.getItem('clients')) : [];
        if (clients.length === 0) {
            document.getElementById('list-khachhang').style.display = 'none';
            return false;
        }

        document.getElementById('list-khachhang').style.display = 'block';
        let tableContent = `<tr>
            <td>STT</td>
            <td width='100'>Mã khách hàng</td>
            <td>Họ và tên</td>
            <td>Quê quán</td>
            <td>Số điện thoại</td>
            <td>Hành động</td>
        </tr>`;

        clients.forEach((client, index) => {
            let clientId = index;
            index++;
            tableContent += `<tr>
                <td>${index}</td>
                <td>${client.makh}</td>
                <td>${client.fullname}</td>
                <td>${client.address}</td>
                <td>${client.phone}</td>
                <td>
                    <a href='#' onclick='editClient(${clientId})'>Edit</a> | <a href='#' onclick='deleteClient(${clientId})'>Delete</a>
                </td>
            </tr>`;
        });

        document.getElementById('grid-clients').innerHTML = tableContent;
    }

    function editClient(index) {
        let clients = localStorage.getItem('clients') ? JSON.parse(localStorage.getItem('clients')) : [];
        let client = clients[index];
        document.getElementById('makh').value = client.makh;
        document.getElementById('fullname').value = client.fullname;
        document.getElementById('address').value = client.address;
        document.getElementById('phone').value = client.phone;
        editIndex = index; // Lưu trữ vị trí khách hàng đang được chỉnh sửa
    }

    function deleteClient(index) {
        let clients = localStorage.getItem('clients') ? JSON.parse(localStorage.getItem('clients')) : [];
        clients.splice(index, 1);
        localStorage.setItem('clients', JSON.stringify(clients));
        renderListClient();
    }
</script>

</html>
